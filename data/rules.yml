version: "2.0"
rules:
- rule: user sends /start command in Telegram, greets the bot, asks how the bot works or says something out of scope
  steps:
  - or:
    - intent: start
    - intent: greet
    - intent: help
    - intent: out_of_scope
  - action: action_offer_chitchat
- rule: NLU prediction confidence is low
  steps:
  - intent: nlu_fallback
  - action: action_default_fallback
- rule: the bot offers chitchat and the user agrees
  steps:
  - action: action_offer_chitchat
  - intent: affirm
  - action: action_find_partner
- rule: the bot falls back to offering chitchat and the user agrees
  steps:
  - action: action_default_fallback
  - intent: affirm
  - action: action_find_partner
- rule: bot starts looking for a partner and the user confirms that they are waiting
  condition:
  - slot_was_set:
    - swiper_action_result: success
  steps:
  - action: action_find_partner
  - or:
    - intent: waiting
    - intent: affirm
  - action: action_rewind
- rule: user confirms that they are waiting for partner to confirm readiness too
  condition:
  - slot_was_set:
    - swiper_action_result: partner_has_been_asked
  steps:
  - action: action_accept_invitation
  - or:
    - intent: waiting
    - intent: affirm
  - action: action_rewind
- rule: bot is unable to find a partner, offers to try searching again and the user agrees
  condition:
  - slot_was_set:
    - swiper_action_result: partner_was_not_found
  steps:
  - action: action_find_partner
  - intent: affirm
  - action: action_find_partner
- rule: action_listen after action_find_partner
  steps:
  - action: action_find_partner
- rule: someone asks the user to join/confirm a video chat
  steps:
  - or:
    - intent: EXTERNAL_ask_to_join
    - intent: EXTERNAL_ask_to_confirm
  - action: action_ask_to_join
- rule: the user aggrees to join the call
  steps:
  - action: action_ask_to_join
  - intent: affirm
  - action: action_accept_invitation
- rule: the user refuses to join the call
  steps:
  - action: action_ask_to_join
  - or:
    - intent: deny
    - intent: another_time
    - intent: stop
  - action: action_reject_invitation
- rule: upon receiving invitation the user asks for a different partner
  steps:
  - action: action_ask_to_join
  - intent: videochat
  - action: action_reject_invitation
  - action: action_find_partner
- rule: ask next random partner
  steps:
  - intent: EXTERNAL_find_partner
  - action: action_find_partner
- rule: a partner confirms readiness for the video chat and the user receives the room url
  steps:
  - intent: EXTERNAL_join_room
  - action: action_join_room
- rule: user asks the bot if the bot is a bot
  steps:
  - intent: bot_challenge
  - action: utter_iamabot
- rule: it took too long for partner to confirm - we need to let the user know that partner is likely not available
  steps:
  - intent: EXTERNAL_expire_partner_confirmation
  - action: action_expire_partner_confirmation

- rule: user asks for video chat directly
  steps:
  - intent: videochat
  - action: action_find_partner
- rule: user asks not to bother them
  steps:
  - intent: stop
  - action: action_do_not_disturb
