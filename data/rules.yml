version: "2.0"
rules:
- rule: user sends /start command in Telegram or just greets the bot
  steps:
  - or:
    - intent: start
    - intent: greet
  - action: action_register_user
  - action: utter_greet_offer_chitchat
- rule: user asks how the bot works
  steps:
  - intent: how_it_works
  - action: utter_how_it_works
- rule: the bot greets the user, offers chitchat and the user agrees
  steps:
  - action: utter_greet_offer_chitchat
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: the bot explains how it works and the user agrees
  steps:
  - action: utter_how_it_works
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: user asks for chitchat directly
  steps:
  - intent: want_chitchat
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: someone with photo asks the user to join a video chat
  condition:
  - slot_was_set:
    - partner_photo_file_id
  steps:
  - intent: EXTERNAL_ask_to_join
  - action: utter_someone_wants_to_chat_photo
  - action: action_ask_to_join
- rule: someone without photo asks the user to join a video chat
  steps:
  - intent: EXTERNAL_ask_to_join
  - action: utter_someone_wants_to_chat
  - action: action_ask_to_join
- rule: someone with photo checks if the user is ready for the call too
  condition:
  - slot_was_set:
    - partner_photo_file_id
  steps:
  - intent: EXTERNAL_ask_if_ready
  - action: utter_found_someone_check_ready_photo
  - action: action_ask_if_ready
- rule: someone without photo checks if the user is ready for the call too
  steps:
  - intent: EXTERNAL_ask_if_ready
  - action: utter_found_someone_check_ready
  - action: action_ask_if_ready
- rule: current user does not respond to invitation, hence reminder to let partner go is triggered
  steps:
  - intent: EXTERNAL_let_partner_go
    entities:
      - partner_id_to_let_go
  - action: utter_ask_for_time_slots_and_impression
  - action: action_let_partner_go
- rule: current user does not respond to readiness confirmation, hence reminder to let partner go is triggered
  steps:
  - intent: EXTERNAL_let_partner_go_not_ready
    entities:
      - partner_id_to_let_go
  - action: utter_ask_for_time_slots_and_impression
  - action: action_let_partner_go_not_ready
- rule: someone else wants to chat and the user aggrees to join
  steps:
  - action: action_ask_to_join
  - or:
    - intent: affirm
    - intent: want_chitchat
  - action: action_confirm_with_asker
- rule: someone else wants to chat but the user refuses to join
  steps:
  - action: action_ask_to_join
  - intent: deny
  - action: utter_declined
  - action: action_do_not_disturb
- rule: user is asked if still ready for the call and confirms
  steps:
  - action: action_ask_if_ready
  - or:
    - intent: affirm
    - intent: want_chitchat
  - action: action_create_room
- rule: user is asked if still ready for the call but rejects
  steps:
  - action: action_ask_if_ready
  - intent: deny
  - action: utter_declined
  - action: action_do_not_disturb_not_ready
- rule: the bot offers to find a replacement for a partner that wasn't waiting anymore and the user agrees
  condition:
  - slot_was_set:
    - swiper_action_result: partner_not_waiting_anymore
  steps:
  - action: action_confirm_with_asker
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: the bot offers to find a replacement for a partner that wasn't waiting for confirmation and the user agrees
  condition:
  - slot_was_set:
    - swiper_action_result: partner_not_waiting_anymore
  steps:
  - action: action_create_room
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: the bot offers to find a replacement for a non-ready partner that wasn't waiting anymore and the user agrees
  steps:
  - action: utter_partner_already_gone
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: a partner rejected chitchat - we need to find someone else for the user
  steps:
  - intent: EXTERNAL_find_partner
  - action: action_find_partner
- rule: a partner is not ready for call anymore - we need to let the user know
  steps:
  - intent: EXTERNAL_report_unavailable
  - action: action_become_ok_to_chitchat
  - action: utter_partner_already_gone
- rule: a partner confirms readiness for the video chat and the user receives the room url
  steps:
  - intent: EXTERNAL_join_room_ready
  - action: utter_partner_ready_room_url
  - action: action_join_room
- rule: user asks not to bother them
  steps:
  - intent: dont_bother_me
  - action: utter_hope_to_see_you_later
  - action: action_do_not_disturb
- rule: user asks the bot if the bot is a bot
  steps:
  - intent: bot_challenge
  - action: utter_iamabot
