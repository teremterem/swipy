version: "2.0"
rules:
- rule: user sends /start command in Telegram, greets the bot or asks how the bot works
  steps:
  - or:
    - intent: start
    - intent: greet
    - intent: how_it_works
  - action: action_metadata_to_slots
  - action: action_offer_chitchat
- rule: the bot offers chitchat and the user agrees
  steps:
  - action: action_offer_chitchat
  - intent: affirm
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
- rule: someone asks the user to join/confirm a video chat
  steps:
  - intent: EXTERNAL_ask_to_join
  - action: action_ask_to_join
#- rule: current user does not respond to invitation, hence reminder to let partner go is triggered
#  steps:
#  - intent: EXTERNAL_let_partner_go
#  - action: action_let_partner_go
- rule: the user aggrees to join the call
  steps:
  - action: action_ask_to_join
  - or:
    - intent: affirm
    - intent: want_chitchat
  - action: action_create_room
- rule: the user refuses to join the call
  steps:
  - action: action_ask_to_join
  - intent: deny
  - action: utter_declined
  - action: action_reject_invitation
- rule: ask next random partner
  steps:
  - intent: EXTERNAL_find_partner
  - action: action_find_partner
- rule: a partner is not ready for the call anymore - we need to look for someone else to connect the user with
  steps:
  - intent: EXTERNAL_report_unavailable
  - action: utter_partner_already_gone
  - action: action_find_partner
- rule: a partner confirms readiness for the video chat and the user receives the room url
  steps:
  - intent: EXTERNAL_join_room
  - action: utter_partner_ready_room_url
  - action: action_join_room
- rule: user asks the bot if the bot is a bot
  steps:
  - intent: bot_challenge
  - action: utter_iamabot
- rule: user asks not to bother them
  steps:
  - intent: dont_bother_me
  - action: utter_hope_to_see_you_later
  - action: action_do_not_disturb
- rule: user asks for chitchat directly
  steps:
  - intent: want_chitchat
  - action: utter_ok_arranging_chitchat
  - action: action_find_partner
